全局数据共享（又叫做：状态管理）是为了解决组件之间数据共享的问题。

开发中常用的全局数据共享方案有：Vuex、Redux、Mobx等。

![image-20230503103409910](http://cdn.789ak.com/img/image-20230503103409910.png)

##### 小程序中的全局数据共享方案

在小程序中，可使用 mobx-miniprogram 配合 mobx-miniprogram-bindings 实现全局数据共享。其中：

- mobx-miniprogram 用来创建Store实例对象
- mobx-miniprogram-bindings 用来把Store中的共享数据或方法，绑定到组件或页面中使用

安装：

```bash
npm i --save mobx-miniprogram mobx-miniprogram-bindings
```

记得重新构建npm组件

### 创建Mobx的Store实例

在小程序根目录下创建 store目录，之后在内创建store.js文件。

```js
	//	变量			方法
import {observable, action} from "mobx-miniprogram"

export const store = observable({
  numA:1,
  numB:2,
    // 计算属性
  get sum() {
    return this.numA + this.numB
  },
    // 方法
  updateNum1: action(function(step) {
    this.numA += step
  }),
  updateNum2: action(function(step) {
    this.numB += step
  })
})
```

### 将Store中的成员绑定到页面中

```js
import { createStoreBindings} from "mobx-miniprogram-bindings"
import { store} from "../../sotre/store"

onLoad(options) {
    this.storeBindings = createStoreBindings(this, {
      store,
      fields: ["numA", "numB", "sum"],
      actions: ["updateNum1"]
    })
  },

  onUnload() {
    this.storeBindings.destroyStoreBindings()
  },
```

### 在页面中使用Store中的成员

```
// wxml
<view>
  {{numA}} + {{numB}} = {{sum}}
</view>
<van-button bindtap="store_data_a_add_b" data-step="{{1}}">a++</van-button>

//	js
store_data_a_add_b(e) {
    this.updateNum1(e.target.dataset.step)
  },
```

### 将Store中的成员绑定到组件中

```js
import {storeBindingsBehavior} from "mobx-miniprogram-bindings"
import { store } from "../../store/store"

Component({
	behaviors: [ storeBindingsBehavior ],
	
	storeBindings: { 
	store, // 指要绑定的Store
	fields: { // 绑定字段的三种方式
		numA: () => store.numA,
		numB: (store) => store.numB,
		sum: "sum"
	},
	actions: { // 指定要绑定的方法
		updateNum1: "updateNum1"
	}
	}
})
```

### 在组件中使用Store中的成员

与在页面中使用Store中的成员相同操作。

